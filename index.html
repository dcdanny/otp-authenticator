<html>
<!-- HTML & JS based 2 factor authenticator supporting the TOTP standard-->
<!-- Web App Interface (c) Daniel Clarke 2015-2022 -->
<head>
	<script type="text/javascript" src="sha.js"></script>
	<script type="text/javascript" src="totp.js"></script>
	<title>Web Authenticator</title>
	<style>
		body {
			font-family: Arial, Helvetica, Sans-serif;
			background-color: #F0F0F0;
		}

		.authString {
			background-color: FFFFFF;
			margin: 10px auto;
			padding: 5px;
			max-width: 600px;
			text-align: center;

			width: 100%;
		}

		.authString span.title {
			color: #666666;
		}

		.authString span.code {
			color: #3388ff;
			font-size: 30pt;
			text-align: center;
		}
	</style>

</head>

<body>
	<h1>Web Authenticator</h1>
	<button onclick="generate()">Reload Codes</button>
	<div id="authSites" class="">

	</div>
	<script>
		//Dictionary of shared secrets for each account. Add to this to include new accounts
		var dict = {
			test1: "testt",
			test: "MSGFS",
			// etc.
		};
		generate();

		function generate() {
			//Remove previous codes from HTML
			var outputEle = document.getElementById("authSites")
			var child = outputEle.lastElementChild; 
			while (child) {
				outputEle.removeChild(child);
				child = outputEle.lastElementChild;
			}
			//Generate and insert for each site
			for (var prop in dict) {
				if (Object.prototype.hasOwnProperty.call(dict, prop)) {
					const authElement = document.createElement("div");
					authElement.className = "authString"
					//Generate TOTP code using JS library
					var totpObj = new TOTP();
					var otp = totpObj.getOTP(dict[prop]);
					authElement.innerHTML = '<span class="code">' + otp + '</span> <br> <span class="title">' + prop + '</span>';
					outputEle.appendChild(authElement);
				}
			}
		}

	</script>
</body>

</html>
